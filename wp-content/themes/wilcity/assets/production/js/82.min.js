(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{521:function(t,i,s){"use strict";s.r(i);var e=s(753),a=s(654);for(var o in a)"default"!==o&&function(t){s.d(i,t,function(){return a[t]})}(o);var n=s(0),r=Object(n.a)(a.default,e.a,e.b,!1,null,null,null);r.options.__file="assets/dev/js/shortcodes/MessageNotifications.vue",i.default=r.exports},654:function(t,i,s){"use strict";s.r(i);var e=s(655),a=s.n(e);for(var o in e)"default"!==o&&function(t){s.d(i,t,function(){return e[t]})}(o);i.default=a.a},655:function(t,i,s){"use strict";var e=s(1);Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var a=e(s(114)),o=e(s(373)),n=e(s(73)),r=s(4),l={data:function(){return{oTranslation:WILCITY_I18,isShowing:!1,isLoading:"no",isListenOutsideClick:!1,needDashboardUrl:"yes",errMsg:"",messageDashboardUrl:this.dashboardUrl+"#/messages",countNewNotifications:0,oNotifications:null}},props:["userId","dashboardUrl"],components:{BlockLoading:n.default},watch:{oNewMessages:{handler:function(t){if(null===t)this.countNewNotifications=0;else{var i=Object.values(t).filter(function(t){return!0===t.new});this.countNewNotifications=i.length,i.sort(function(t,i){return i.timestamp-t.timestamp}),this.oNotifications=(0,o.default)(i)}},immediate:!0}},computed:(0,a.default)({wrapperNotificationsClass:function(){return this.isShowing?"header_loginBody__2hz2g active":"header_loginBody__2hz2g"},aCssClass:function(){return this.isShowing?"header_loginHead__3HoVP active":"header_loginHead__3HoVP"}},(0,r.mapState)({oNewMessages:function(t){return t.ModuleMessage.oMyNewMessages},isUsingFirebase:function(t){return"yes"===t.ModuleMessage.isUsingFirebase}})),mounted:function(){var t=this;this.isUsingFirebase?this.getMyNewMessages():setTimeout(function(){t.fetchNewNotifications(),t.$store.commit("updateTimeout")},this.$store.getters.getTimeout),this.hideMenuWhenOutsideClick()},methods:{getMyNewMessages:function(){var t=this;return this.$store.dispatch("ModuleMessage/signInToFirebase").then(function(i){i&&t.$store.dispatch("ModuleMessage/fetchMyNewMessages")})},renderLink:function(t){return this.isUsingFirebase?this.dashboardUrl+"#/messages?u="+t.displayName:t.link},buildUserKey:function(){return"___"+this.userId+"___"},sentAt:function(t){return this.isUsingFirebase?WilCityHelpers.timestampToDate(t.timestamp):t.time},pollingNotification:function(){var t=this;setInterval(function(){t.fetchNewNotifications()},3e5)},fetchNewNotifications:function(){var t=this;jQuery.ajax({type:"POST",url:WILOKE_GLOBAL.ajaxurl,data:{action:"wilcity_count_new_messages"},success:function(i){t.countNewNotifications=i.data}})},toggleShowing:function(){var t=this;this.isShowing=!this.isShowing,this.isUsingFirebase?this.isLoading="no":(this.isLoading="yes",jQuery.ajax({type:"post",url:WILOKE_GLOBAL.ajaxurl,data:{action:"wilcity_fetch_list_messages",needDashboardUrl:this.needDashboardUrl,limit:5},success:function(i){i.success?(t.oNotifications=i.data.aInfo,"#"===t.messageDashboardUrl&&(t.messageDashboardUrl=i.data.dashboardUrl,t.needDashboardUrl="no")):t.errMsg=i.data.msg,t.isLoading="no"}}))},hideMenuWhenOutsideClick:function(){var t=this;jQuery(document).on("click",function(i){jQuery(i.target).hasClass("js-message-notification")||(t.isShowing=!1)})}}};i.default=l},753:function(t,i,s){"use strict";var e=function(){var t=this,i=t.$createElement,s=t._self._c||i;return s("div",[s("a",{class:t.aCssClass,attrs:{href:"#","data-toggle-minWidth":"768",dataTooltip:t.oTranslation.messages,"data-tooltip-placement":"top","data-tooltip-theme":"light"},on:{click:function(i){return i.preventDefault(),t.toggleShowing(i)}}},[s("i",{staticClass:"la la-envelope js-message-notification"}),s("span",{directives:[{name:"show",rawName:"v-show",value:t.countNewNotifications,expression:"countNewNotifications"}],staticClass:"header_number__1a6F5 bg-color-quaternary"},[t._v(t._s(t.countNewNotifications))])]),t._v(" "),s("div",{class:t.wrapperNotificationsClass},[s("div",{directives:[{name:"show",rawName:"v-show",value:"yes"==t.isLoading,expression:"isLoading=='yes'"}],staticClass:"pos-r",staticStyle:{"min-height":"100px"}},[s("block-loading",{attrs:{"is-loading":t.isLoading,position:"pos-a-center"}})],1),t._v(" "),s("ul",{directives:[{name:"show",rawName:"v-show",value:"no"==t.isLoading,expression:"isLoading=='no'"}],staticClass:"list-utility_module__32oNg list-none list-utility_abs__OYiyL arrow--top-right"},[t._l(t.oNotifications,function(i){return s("li",{staticClass:"list-utility_list__1DzGk"},[s("a",{staticClass:"list-utility_link__3BRZx",attrs:{href:t.renderLink(i)}},[s("div",{staticClass:"utility-box-1_module__MYXpX utility-box-1_sm__mopok utility-box-1_boxLeft__3iS6b clearfix "},[i.avatar?s("div",{staticClass:"utility-box-1_avatar__DB9c_ rounded-circle",style:{"background-image":"url("+i.avatar+")"}},[s("img",{attrs:{src:i.avatar,alt:i.displayName}})]):t._e(),t._v(" "),s("div",{staticClass:"utility-box-1_body__8qd9j"},[s("div",{staticClass:"utility-box-1_group__2ZPA2 text-ellipsis",staticStyle:{"white-space":"normal"}},[i.displayName?s("h3",{staticClass:"utility-box-1_title__1I925",domProps:{innerHTML:t._s(i.displayName)}}):t._e(),t._v(" "),s("div",{staticClass:"utility-box-1_content__3jEL7",domProps:{innerHTML:t._s(i.message)}})]),t._v(" "),s("div",{staticClass:"utility-box-1_description__2VDJ6"},[s("i",{staticClass:"la la-comments color-primary"}),t._v(" "),s("span",{domProps:{innerHTML:t._s(t.sentAt(i))}})])])])])])}),t._v(" "),s("li",{staticClass:"list-utility_list__1DzGk"},[s("a",{staticClass:"list-utility_more__2Y_w7 wil-text-center color-primary--hover",attrs:{href:t.messageDashboardUrl},domProps:{innerHTML:t._s(t.oTranslation.viewAll)}})])],2),t._v(" "),s("ul",{directives:[{name:"show",rawName:"v-show",value:t.errMsg.length,expression:"errMsg.length"}],staticClass:"list-utility_module__32oNg list-none list-utility_abs__OYiyL arrow--top-right"},[s("li",{staticClass:"list-utility_list__1DzGk"},[s("a",{staticClass:"list-utility_link__3BRZx",attrs:{href:"#"}},[s("div",{staticClass:"utility-box-1_module__MYXpX utility-box-1_sm__mopok utility-box-1_boxLeft__3iS6b clearfix"},[s("div",{staticClass:"utility-box-1_body__8qd9j"},[s("div",{staticClass:"utility-box-1_group__2ZPA2 text-ellipsis"},[s("div",{staticClass:"utility-box-1_content__3jEL7",domProps:{innerHTML:t._s(t.errMsg)}})])])])])])])])])},a=[];e._withStripped=!0,s.d(i,"a",function(){return e}),s.d(i,"b",function(){return a})}}]);